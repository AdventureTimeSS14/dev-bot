import datetime

from bot_init import bot
from config import LOG_CHANNEL_ID


@bot.event
async def on_command(ctx):
    """
    –õ–æ–≥–∏—Ä—É–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã –≤ —É–∫–∞–∑–∞–Ω–Ω—ã–π –ª–æ–≥-–∫–∞–Ω–∞–ª –∏ –≤—ã–≤–æ–¥–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ –∫–æ–Ω—Å–æ–ª—å.
    """
    # –ü–æ–ª—É—á–∞–µ–º –∫–∞–Ω–∞–ª –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
    channel = bot.get_channel(LOG_CHANNEL_ID)
    if not channel:
        print(f"‚ùå –õ–æ–≥-–∫–∞–Ω–∞–ª —Å ID {LOG_CHANNEL_ID} –Ω–µ –Ω–∞–π–¥–µ–Ω.")
        return

    # –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è
    current_time = datetime.datetime.now().strftime("%Y-%m-%d %H:%M:%S")

    # –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
    log_message = format_command_log_message(ctx, current_time)

    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ª–æ–≥-—Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –∫–∞–Ω–∞–ª
    try:
        await channel.send(log_message)
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –ª–æ–≥-—Å–æ–æ–±—â–µ–Ω–∏—è –≤ –∫–∞–Ω–∞–ª: {e}")

    # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–Ω—Å–æ–ª—å
    print(f"‚úÖ –ö–æ–º–∞–Ω–¥–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞: {ctx.command.name} –æ—Ç {ctx.author} –≤ –∫–∞–Ω–∞–ª–µ {ctx.channel} –≤ {current_time}")


def format_command_log_message(ctx, current_time):
    """
    –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–π –∫–æ–º–∞–Ω–¥–µ.
    """
    return (
        f"üéØ **–ö–æ–º–∞–Ω–¥–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞:** `{ctx.command.name}`\n"
        f"üôã **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:** {ctx.author} (ID: {ctx.author.id})\n"
        f"üìÑ **–ö–∞–Ω–∞–ª:** {ctx.channel} (ID: {ctx.channel.id})\n"
        f"‚è∞ **–í—Ä–µ–º—è:** {current_time}\n"
        f"üîó **–°—Å—ã–ª–∫–∞ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ:** [–ü–µ—Ä–µ–π—Ç–∏ –∫ —Å–æ–æ–±—â–µ–Ω–∏—é]"
        f"(https://discord.com/channels/{ctx.guild.id}/{ctx.channel.id}/{ctx.message.id})"
    )